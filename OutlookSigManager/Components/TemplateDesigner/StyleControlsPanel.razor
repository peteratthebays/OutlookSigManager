@namespace OutlookSigManager.Components.TemplateDesigner
@using OutlookSigManager.Models

<div class="card mb-3">
    <div class="card-header">
        <i class="bi bi-palette me-2"></i>Styling
    </div>
    <div class="card-body">
        <div class="mb-3">
            <label class="form-label">Signature Width</label>
            <div class="d-flex align-items-center gap-2">
                <input type="range"
                       class="form-range flex-grow-1"
                       min="250"
                       max="600"
                       value="@Design.SignatureWidth"
                       @onchange="OnSignatureWidthChanged" />
                <div class="input-group" style="width: 120px;">
                    <input type="number"
                           class="form-control form-control-sm"
                           min="250"
                           max="600"
                           value="@Design.SignatureWidth"
                           @onchange="OnSignatureWidthChanged" />
                    <span class="input-group-text input-group-text-sm">px</span>
                </div>
            </div>
            <small class="text-muted">Total width of the signature block</small>
        </div>

        <div class="mb-3">
            <label class="form-label">Font Family</label>
            <select class="form-select"
                    value="@Design.FontFamily"
                    @onchange="OnFontFamilyChanged">
                <option value="Roboto, Calibri, sans-serif">Roboto (Brand Default)</option>
                <option value="Calibri, sans-serif">Calibri</option>
                <option value="Arial, sans-serif">Arial</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Segoe UI', sans-serif">Segoe UI</option>
                <option value="Tahoma, sans-serif">Tahoma</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Font Size</label>
            <select class="form-select"
                    value="@Design.FontSize"
                    @onchange="OnFontSizeChanged">
                <option value="8pt">8pt</option>
                <option value="9pt">9pt</option>
                <option value="10pt">10pt</option>
                <option value="11pt">11pt</option>
                <option value="12pt">12pt</option>
                <option value="14pt">14pt</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Primary Color</label>
            <select class="form-select"
                    value="@Design.PrimaryColor"
                    @onchange="OnPrimaryColorChanged">
                <optgroup label="Corporate">
                    <option value="#3154A5">Sky Blue (Brand Default)</option>
                    <option value="#26B686">Coastal Green</option>
                    <option value="#77787B">Dark Grey</option>
                </optgroup>
                <optgroup label="Clinical Divisions">
                    <option value="#FBAA34">Rich Sandy Yellow (Surgical)</option>
                    <option value="#41C5E5">Water Blue (Oncology)</option>
                    <option value="#72216D">Dusk Purple (Aged Care)</option>
                </optgroup>
            </select>
            <div class="mt-1 d-flex align-items-center gap-2">
                <div style="width: 24px; height: 24px; background-color: @Design.PrimaryColor; border: 1px solid #ccc; border-radius: 4px;"></div>
                <small class="text-muted">Used for name and accents</small>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Secondary Color</label>
            <select class="form-select"
                    value="@Design.SecondaryColor"
                    @onchange="OnSecondaryColorChanged">
                <optgroup label="Corporate">
                    <option value="#77787B">Dark Grey (Brand Default)</option>
                    <option value="#747474">Warm Dark Grey</option>
                    <option value="#999281">Green Grey</option>
                </optgroup>
                <optgroup label="Base Palette">
                    <option value="#ACA593">Warm Green</option>
                    <option value="#D1C6B0">Warm Tan</option>
                </optgroup>
            </select>
            <div class="mt-1 d-flex align-items-center gap-2">
                <div style="width: 24px; height: 24px; background-color: @Design.SecondaryColor; border: 1px solid #ccc; border-radius: 4px;"></div>
                <small class="text-muted">Used for other text</small>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Divider Color</label>
            <select class="form-select"
                    value="@Design.DividerColor"
                    @onchange="OnDividerColorChanged">
                <optgroup label="Corporate">
                    <option value="#3154A5">Sky Blue (Brand Default)</option>
                    <option value="#26B686">Coastal Green</option>
                    <option value="#77787B">Dark Grey</option>
                </optgroup>
                <optgroup label="Clinical Divisions">
                    <option value="#FBAA34">Rich Sandy Yellow (Surgical)</option>
                    <option value="#41C5E5">Water Blue (Oncology)</option>
                    <option value="#72216D">Dusk Purple (Aged Care)</option>
                </optgroup>
            </select>
            <div class="mt-1 d-flex align-items-center gap-2">
                <div style="width: 24px; height: 24px; background-color: @Design.DividerColor; border: 1px solid #ccc; border-radius: 4px;"></div>
                <small class="text-muted">Line between logo and content</small>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public TemplateDesign Design { get; set; } = new();
    [Parameter] public EventCallback<TemplateDesign> DesignChanged { get; set; }

    private async Task NotifyDesignChanged()
    {
        await DesignChanged.InvokeAsync(Design);
    }

    private async Task OnSignatureWidthChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var width))
        {
            Design.SignatureWidth = Math.Clamp(width, 250, 600);
            await NotifyDesignChanged();
        }
    }

    private async Task OnFontFamilyChanged(ChangeEventArgs e)
    {
        Design.FontFamily = e.Value?.ToString() ?? "Arial, sans-serif";
        await NotifyDesignChanged();
    }

    private async Task OnFontSizeChanged(ChangeEventArgs e)
    {
        Design.FontSize = e.Value?.ToString() ?? "10pt";
        await NotifyDesignChanged();
    }

    private async Task OnPrimaryColorChanged(ChangeEventArgs e)
    {
        Design.PrimaryColor = e.Value?.ToString() ?? "#3154A5";
        await NotifyDesignChanged();
    }

    private async Task OnSecondaryColorChanged(ChangeEventArgs e)
    {
        Design.SecondaryColor = e.Value?.ToString() ?? "#77787B";
        await NotifyDesignChanged();
    }

    private async Task OnDividerColorChanged(ChangeEventArgs e)
    {
        Design.DividerColor = e.Value?.ToString() ?? "#3154A5";
        await NotifyDesignChanged();
    }
}
