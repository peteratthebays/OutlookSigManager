# OutlookSigManager - Brain Dump

## What We've Built

### Core Application
- Blazor Server app (.NET 10) with Microsoft Identity authentication (Azure AD/Entra ID)
- Three-page architecture replacing the original single dashboard

### Page 1: Signature Creator (`/` and `/signature-creator`)
- Available to all authenticated users
- Auto-loads logged-in user's profile from Graph API (via email claim lookup)
- Override form for local customizations (name, title, department, phones, working days)
- Overrides are signature-only, NOT pushed to Entra ID
- Live signature preview using admin-defined template
- Copy to clipboard with Outlook paste instructions

### Page 2: User Audit (`/user-audit`) - Admin Only
- Grid view of all Entra ID users
- Inline click-to-edit for: Job Title, Department, Business Phone, Mobile Phone
- Display Name and Email are read-only
- Yellow highlight for unsaved changes
- Per-row Save/Revert buttons
- Save All/Revert All for batch operations
- Changes saved directly to Entra ID via Graph API

### Page 3: Template Designer (`/template-designer`) - Admin Only
- Visual signature template editor
- Global settings: Font family, font size, primary/secondary colors
- Per-field configuration:
  - Enable/disable toggle
  - Custom prefix (e.g., "P: " for phone)
  - Per-field font size override
  - Per-field color override
  - Bold toggle
  - Reorder fields (move up/down)
- Logo upload (beside signature) with width slider
- Banner upload (below signature) with width slider and hyperlink URL
- Disclaimer text
- Live preview with sample data
- JSON file persistence (`Data/templates/default-template.json`)

### Services
- `GraphUserService` - Entra ID user CRUD via Graph API (app-only auth)
- `TemplateStorageService` - Template JSON persistence
- `SignatureTemplateService` - Dynamic HTML signature generation from TemplateDesign
- `SignatureAuditService` - Orchestrates signature auditing (existing)
- `EwsSignatureService` - Exchange signature operations (existing)

### Models
- `TemplateDesign` - Template styling, fields, logos, disclaimer
- `TemplateField` - Individual field config with per-field styling
- `EditableUserProfile` - Mutable user profile with change tracking
- `SignatureFieldOverride` - Local signature overrides

### Authorization
- `AdminOnly` policy based on Entra ID group membership
- Configured via `AdminSettings:AdminGroupId` in appsettings.json
- Falls back to authenticated user if no group configured (dev mode)

---

## Last Session

Added per-field styling (font size and color) to the Template Designer, created a Banner Uploader component for adding a clickable banner image below signatures, and fixed the User Audit page save button which wasn't triggering UI updates after state changes. The Template Designer now has properly sized buttons and a cleaner field configuration UI with color pickers, font size dropdowns, and a reset-to-default option for per-field colors. Also fixed layout blowout issues when uploading logos by truncating base64 in the Raw HTML display and making that section collapsible.

---

## Testing Required

- [ ] Template Designer: Upload logo, verify preview updates correctly
- [ ] Template Designer: Upload banner with hyperlink, verify clickable in preview
- [ ] Template Designer: Change per-field colors and font sizes, verify in preview
- [ ] Template Designer: Save template, reload page, verify persistence
- [ ] Template Designer: Reset to default, verify fields reset
- [ ] User Audit: Edit a user's job title, click Save, verify change in Entra ID
- [ ] User Audit: Edit multiple users, use Save All, verify batch update
- [ ] User Audit: Verify Revert button restores original values
- [ ] Signature Creator: Verify user profile loads from claims
- [ ] Signature Creator: Enter overrides, verify preview updates
- [ ] Signature Creator: Copy signature, paste into Outlook, verify formatting
- [ ] Authorization: Non-admin user should NOT see admin nav items
- [ ] Authorization: Direct URL to admin pages should deny non-admin users

---

## Next Steps

1. **Configure Admin Group** - Set `AdminSettings:AdminGroupId` to actual Entra ID group GUID
2. **Test Authorization Flow** - Verify admin vs non-admin experience
3. **Error Handling** - Add user-friendly error messages for Graph API failures
4. **Validation** - Add input validation for URLs (banner link), phone numbers
5. **Template Versioning** - Consider multiple template support or template history
6. **Signature Deployment** - Implement push-to-mailbox via EWS (existing service)
7. **Audit Logging** - Log who changed what in User Audit
8. **Mobile Responsiveness** - Test and fix layout on smaller screens
9. **Loading States** - Improve skeleton loaders for better UX
10. **Clean Up** - Remove unused pages (Counter, Weather) and dead code
